<script type="text/javascript">
        var gk_isXlsx = false;
        var gk_xlsxFileLookup = {};
        var gk_fileData = {};
        function filledCell(cell) {
          return cell !== '' && cell != null;
        }
        function loadFileData(filename) {
        if (gk_isXlsx && gk_xlsxFileLookup[filename]) {
            try {
                var workbook = XLSX.read(gk_fileData[filename], { type: 'base64' });
                var firstSheetName = workbook.SheetNames[0];
                var worksheet = workbook.Sheets[firstSheetName];

                // Convert sheet to JSON to filter blank rows
                var jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1, blankrows: false, defval: '' });
                // Filter out blank rows (rows where all cells are empty, null, or undefined)
                var filteredData = jsonData.filter(row => row.some(filledCell));

                // Heuristic to find the header row by ignoring rows with fewer filled cells than the next row
                var headerRowIndex = filteredData.findIndex((row, index) =>
                  row.filter(filledCell).length >= filteredData[index + 1]?.filter(filledCell).length
                );
                // Fallback
                if (headerRowIndex === -1 || headerRowIndex > 25) {
                  headerRowIndex = 0;
                }

                // Convert filtered JSON back to CSV
                var csv = XLSX.utils.aoa_to_sheet(filteredData.slice(headerRowIndex)); // Create a new sheet from filtered array of arrays
                csv = XLSX.utils.sheet_to_csv(csv, { header: 1 });
                return csv;
            } catch (e) {
                console.error(e);
                return "";
            }
        }
        return gk_fileData[filename] || "";
        }
        </script><!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>FLYNET</title>
  <link rel="stylesheet" href="style.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=SF+Pro+Display:wght@400;500;600&display=swap" rel="stylesheet">
</head>
<body class="theme-dark">

  <!-- Auth -->
  <div id="auth" class="screen">
    <div class="auth-container">
      <h2>üöÄ FLYNET</h2>
      <input type="email" id="email" placeholder="Email" />
      <input type="password" id="password" placeholder="–ü–∞—Ä–æ–ª—å" />
      <button onclick="handleLogin()">–í–æ–π—Ç–∏</button>
      <button onclick="handleRegister()">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</button>
      <hr />
      <button class="google-btn" onclick="signInWithGoogle()">
        <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" width="20" /> –í–æ–π—Ç–∏ —á–µ—Ä–µ–∑ Google
      </button>
    </div>
  </div>

  <!-- Chat -->
  <div id="chat" class="screen hidden">
    <!-- Sidebar -->
    <div class="sidebar" id="sidebar">
      <div class="header">
        <div>–ß–∞—Ç—ã</div>
        <button onclick="openCreateGroupModal()" class="icon-btn">‚ûï</button>
        <button onclick="openSettings()" class="icon-btn">‚öôÔ∏è</button>
      </div>
      <div class="chat-list" id="chatList">
        <div class="loading">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
      </div>
    </div>

    <!-- Main Chat -->
    <div class="main" id="mainChat">
      <div class="header">
        <button class="back-btn" onclick="showChats()">‚Äπ</button>
        <div id="chatTitle">–í—ã–±–µ—Ä–∏—Ç–µ —á–∞—Ç</div>
        <button onclick="toggleEmojiPanel()" class="icon-btn">üôÇ</button>
        <button onclick="openBots()" class="icon-bot">ü§ñ</button>
      </div>
      <div id="messages"></div>
      <div class="input-area">
        <input type="file" id="mediaInput" accept="image/*,video/*" style="display:none;" onchange="sendMedia(event)" />
        <button onclick="document.getElementById('mediaInput').click()" class="icon-btn">üìé</button>
        <input type="text" id="messageInput" placeholder="–°–æ–æ–±—â–µ–Ω–∏–µ" onkeypress="if(event.key==='Enter') sendMessage()" />
        <button onclick="sendMessage()">‚û§</button>
      </div>
    </div>

    <!-- Emoji Panel -->
    <div class="emoji-panel" id="emojiPanel">
      <div class="emoji-category">
        <div class="emoji-category-title">–°–º–∞–π–ª—ã</div>
        <div class="emoji-grid" id="emojiGrid"></div>
      </div>
    </div>

    <!-- Settings Panel -->
    <div class="settings-panel" id="settingsPanel">
      <div class="settings-header">
        <span>–ù–∞—Å—Ç—Ä–æ–π–∫–∏</span>
        <button onclick="closeSettings()" class="icon-btn">‚úï</button>
      </div>
      <div class="settings-content">
        <div class="setting-item">
          <label>–¢–µ–º–∞:</label>
          <select id="themeSelect" onchange="changeTheme(this.value)">
            <option value="dark">–¢—ë–º–Ω–∞—è</option>
            <option value="light">–°–≤–µ—Ç–ª–∞—è</option>
            <option value="blue">–°–∏–Ω—è—è</option>
          </select>
        </div>
        <div class="setting-item">
          <label>–¶–≤–µ—Ç —Ñ–æ–Ω–∞:</label>
          <input type="color" id="bgColorPicker" onchange="changeBgColor(this.value)" />
        </div>
        <div class="setting-item">
          <label>–¶–≤–µ—Ç —Ç–µ–∫—Å—Ç–∞:</label>
          <input type="color" id="textColorPicker" onchange="changeTextColor(this.value)" />
        </div>
        <div class="setting-item">
          <label>–ê–∫—Ü–µ–Ω—Ç–Ω—ã–π —Ü–≤–µ—Ç:</label>
          <input type="color" id="accentColorPicker" onchange="changeAccentColor(this.value)" />
        </div>
        <div class="setting-item">
          <button onclick="logout()">–í—ã–π—Ç–∏ –∏–∑ –∞–∫–∫–∞—É–Ω—Ç–∞</button>
        </div>
        <div class="setting-item">
          <button onclick="deleteAccount()" style="background:#d93025;">–£–¥–∞–ª–∏—Ç—å –∞–∫–∫–∞—É–Ω—Ç</button>
        </div>
      </div>
    </div>

    <!-- Bots Panel -->
    <div class="bots-panel" id="botsPanel">
      <div class="settings-header">
        <span>–ë–æ—Ç—ã</span>
        <button onclick="closeBots()" class="icon-btn">‚úï</button>
      </div>
      <div class="settings-content">
        <div class="setting-item">
          <label>–ò–º—è –±–æ—Ç–∞:</label>
          <input type="text" id="botName" placeholder="–ò–º—è –±–æ—Ç–∞" />
        </div>
        <div class="setting-item">
          <label>–û–ø–∏—Å–∞–Ω–∏–µ:</label>
          <textarea id="botDescription" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ –±–æ—Ç–∞"></textarea>
        </div>
        <div class="setting-item">
          <button onclick="createBot()">–°–æ–∑–¥–∞—Ç—å –±–æ—Ç–∞</button>
        </div>
        <div id="botList"></div>
      </div>
    </div>

    <!-- Create Group Modal -->
    <div id="createGroupModal" class="modal hidden">
      <div class="modal-content">
        <h3>–°–æ–∑–¥–∞—Ç—å –≥—Ä—É–ø–ø—É</h3>
        <input type="text" id="groupName" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –≥—Ä—É–ø–ø—ã" />
        <div class="user-list" id="userListForGroup"></div>
        <button onclick="createGroup()">–°–æ–∑–¥–∞—Ç—å</button>
        <button onclick="closeCreateGroupModal()">–û—Ç–º–µ–Ω–∞</button>
      </div>
    </div>
  </div>

  <script type="module" src="script.js"></script>
</body>
</html>